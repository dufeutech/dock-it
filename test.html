<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lumino-easy - ESM Test</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        overflow: hidden;
        font-family: system-ui, sans-serif;
      }
      #dock {
        height: 100%;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <lumino-dock id="dock"></lumino-dock>

    <!-- ESM Version - fully standalone, no external CSS needed -->
    <script type="module">
      import { Widget } from "./dist/lumino-easy.es.js";

      const dock = document.getElementById("dock");

      // Configure the dock
      dock.config = {
        widgets: {
          code_editor: (cfg) =>
            Widget.create({
              ...cfg,
              kind: "code_editor",
              render: (ctx) => `
              <div style="padding: 20px; color: #ccc;">
                <h2 style="margin-top: 0;">${ctx.label}</h2>
                <p>ID: <code>${ctx.id}</code></p>
                <p>Closable: ${ctx.closable ? "Yes" : "No"}</p>
                <button onclick="alert('Hello from ${
                  ctx.label
                }!')">Click me</button>
              </div>
            `,
            }),
        },
        onTabAdded: (config) => {
          Widget.closer(config, ({ el }) => {
            console.log(config.closable);
            // `X` close `cirlce`
            const isClose = true;
            if (isClose) {
              el.textContent = "X";
              //el.style.marginTop = "-5px";
            } else {
              el.textContent = "â—";
              el.style.fontSize = "40px";
              el.style.marginTop = "-5px";
            }

            // Click Event
            return () => console.log("CLOSE");
          });
          console.log("[tab added]", config.tab.dataset.id);
        },
        onTabRemoved: (config) => {
          console.log("[tab removed]", config.view.id);
        },
      };

      // Create widgets
      const widgetA = dock.api.widget("code_editor", {
        id: "code-editor-1",
        label: "index.js",
      });
      const widgetB = dock.api.widget("code_editor", {
        id: "code-editor-2",
        label: "style.css",
      });
      const widgetC = dock.api.widget("code_editor", {
        id: "code-editor-3",
        label: "README.md",
        closable: false,
      });

      // Add widgets
      dock.api.add(widgetA);
      dock.api.add(widgetB, { mode: "split-right", ref: widgetA });
      dock.api.add(widgetC, { mode: "tab-after", ref: widgetB });

      // Handle resize
      window.addEventListener("resize", () => dock.update());

      console.log("Dock initialized!", dock.api);

      // Save
      const layout = dock.api.saveJSON();
      localStorage.setItem("dock-layout", layout);

      /*
      // Delete
      setTimeout(() => dock.api.dispose(), 500);

      // Load
      setTimeout(() => {
        const saved = localStorage.getItem("dock-layout");
        dock.api.loadJSON(saved);
      }, 2000);
      */
    </script>
  </body>
</html>
